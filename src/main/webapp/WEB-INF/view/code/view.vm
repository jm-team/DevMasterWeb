<!DOCTYPE html>
<html>
<head>
<meta charset="UTF-8">
<title>index</title>
<link rel="stylesheet" type="text/css" href="${ServiceName}/assets/easyui/themes/metro/easyui.css">
<link rel="stylesheet" type="text/css" href="${ServiceName}/assets/easyui/themes/icon.css">
<script src='${ServiceName}/assets/js/jquery-2.0.3.min.js' ></script>
<script src='${ServiceName}/assets/js/layer/layer.js' ></script>
<script type="text/javascript" src="${ServiceName}/assets/easyui/jquery.easyui.min.js"></script>
<style>
	#tree a{
		text-decoration:none;
    }
	
	.my-tree-folder-icon{
		width: 18px;
		background: url(${ServiceName}/assets/easyui/themes/icons/custom/folder_flat_light.png) no-repeat;
	}
	
	.my-tree-html-icon{
		background: url(${ServiceName}/assets/easyui/themes/icons/custom/html.png) no-repeat;
	}
	
	.my-tree-js-icon{
		background: url(${ServiceName}/assets/easyui/themes/icons/custom/page_white_code.png) no-repeat;
	}
	
	.my-tree-css-icon{
		background: url(${ServiceName}/assets/easyui/themes/icons/custom/page_white_code_red.png) no-repeat;
	}
	
	.my-tree-xml-icon{
		background: url(${ServiceName}/assets/easyui/themes/icons/custom/page_white_text.png) no-repeat;
	}
	
	.my-tree-picture-icon{
		background: url(${ServiceName}/assets/easyui/themes/icons/custom/image.png) no-repeat;
	}
	
	.my-tree-sql-icon{
		background: url(${ServiceName}/assets/easyui/themes/icons/custom/page_white_text.png) no-repeat;
	}
	
	.my-tree-default-icon{
		background: url(${ServiceName}/assets/easyui/themes/icons/custom/page_white.png) no-repeat;
	}
	
</style>
<script type="text/javascript">

var extensionClassMapper = {};
extensionClassMapper['folder']  = 'my-tree-folder-icon';
extensionClassMapper['html']    = 'my-tree-html-icon';
extensionClassMapper['js']      = 'my-tree-js-icon';
extensionClassMapper['css']     = 'my-tree-css-icon';
extensionClassMapper['xml']     = 'my-tree-xml-icon';
extensionClassMapper['sql']     = 'my-tree-sql-icon';
extensionClassMapper['default'] = 'my-tree-default-icon';

extensionClassMapper['jpg']     = 'my-tree-picture-icon';
extensionClassMapper['png']     = 'my-tree-picture-icon';

function getIconClass(fileName, isFile){
	if(!isFile){
		return extensionClassMapper['folder'];
	}
	
	if(fileName == null || fileName == undefined || fileName == '' || fileName.lastIndexOf('.') == -1){
		return extensionClassMapper['default'];
	}
	
	var extension = fileName.substring(fileName.lastIndexOf('.') + 1).toLowerCase();
	var iconClass = extensionClassMapper[extension];
	
	if(iconClass == null || iconClass == undefined || iconClass == ''){
		iconClass = extensionClassMapper['default'];
	}
	
	return iconClass;
}


/**
 * 双击文件后，打开tab
 * 如果已经打开，则选中
 */
function onNodeDblClick(node){
	if(!node.folder){
		openCodeFrame(node.id, node.text);
	}
}

/**
 * 双击文件后，打开tab
 * 如果已经打开，则选中
 */
function openCodeFrame(path, name){
	var ele = $('#contentTabs');
	var tabs = ele.tabs('tabs');
	
	for(var i = 0; i < tabs.length; i++){
		if(tabs[i][0].id == path){
			var index = ele.tabs('getTabIndex', tabs[i]);
			ele.tabs('select', index);
			return;
		}
	}
	
	var imgExtends = ['jpg', 'png'];
	var extend = name.substring(name.lastIndexOf('.') + 1);
	
	if(jQuery.inArray(extend, imgExtends) > 0){
	
		ele.tabs('add', {
    		id : path,
    		title : name,
    		selected : true,
    		closable : true,
            content : '<div><img src="${ServiceName}/project/picture?path=' + path + '"></div>'
    	});
		
		return;
	}
	
	ele.tabs('add', {
		id : path,
		title : name,
		selected : true,
		closable : true,
		content : '<iframe src="${ServiceName}/code/viewFile?projectName=${projectName}&path='+path+'" width="100%" height="98%"></iframe>'
	});
}



</script>
</head>
<body class="easyui-layout">
	
	<!-- left start -->
	<div data-options="region:'west',split:true,title:''" style="width:15%;padding:10px;background: transparent;">
		<ul id="tree" class="easyui-tree" url="${ServiceName}/code/getFiles?projectId=${projectId}" data-options="
                method: 'get',
                animate: true,
				onDblClick : onNodeDblClick
            ">
		    
		</ul>
	</div>
	
	<!-- left end -->
	
	
	<!-- center start -->
	<div data-options="region:'center',border:false,title:''">
		<div class="easyui-layout" data-options="fit:true">
			<!-- center top start -->
			<div data-options="region:'center',split:true" style="background:#fbfbfb;">
				<div id="contentTabs" class="easyui-tabs" style="width:100%;height:100%;"></div>
			</div>
			<!-- center top end -->
			
		</div>
	</div>
	<!-- center end -->
</body>
</html>